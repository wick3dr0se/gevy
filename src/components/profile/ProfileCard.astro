---
import { Image } from "astro:assets";
import FollowButton from "./FollowButton.astro";
import MapPopover from "./MapPopover.astro";
import RepoGrid from "./RepoGrid.astro";
import GitHubReadme from "../GitHubReadme.astro";

interface Props {
  profile: any;
  isOwnProfile: boolean;
  isFollowing: boolean;
}

const { profile, isOwnProfile, isFollowing } = Astro.props;
const repos = profile.repos || [];
const profileReadmeHtml = profile.readme_html || null;
---

<div class="break-word rounded-lg shadow-sm border p-6">
  <div class="flex flex-wrap items-start gap-6">
    <Image
      src={profile.avatar_url}
      alt={profile.github_username}
      width="192"
      height="192"
      class="rounded-full"
      loading="lazy"
    />

    <div class="flex-1">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold">
            {profile.name || profile.github_username}
          </h1>
          <p class="text-[var(--subtext)]">@{profile.github_username}</p>
        </div>

        {
          !isOwnProfile && (
            <FollowButton followingId={profile.id} isFollowing={isFollowing} />
          )
        }
      </div>

      {profile.bio && <p class="mt-3 text-[var(--subtext)]">{profile.bio}</p>}

      <div class="mt-4 flex flex-wrap gap-6 text-sm">
        <div>
          <span class="font-semibold">{profile.public_repos}</span>
          <span class="text-[var(--subtext)]"> repositories</span>
        </div>
        <div>
          <span class="font-semibold">{profile.followers_count}</span>
          <span class="text-[var(--subtext)]"> followers</span>
        </div>
        <div>
          <span class="font-semibold">{profile.following_count}</span>
          <span class="text-[var(--subtext)]"> following</span>
        </div>
      </div>

      {
        (profile.location || profile.blog) && (
          <div class="mt-4 flex flex-wrap gap-4 text-sm text-[var(--subtext)]">
            {profile.location && <MapPopover location={profile.location} />}
            {profile.blog && (
              <span class="flex items-center gap-1">
                ðŸ”—
                <a
                  href={profile.blog}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="underline"
                >
                  {profile.blog}
                </a>
              </span>
            )}
          </div>
        )
      }
    </div>
  </div>

  {
    profileReadmeHtml && (
      <GitHubReadme html={profileReadmeHtml} class="mx-auto max-w-4xl p-6" />
    )
  }

  {repos.length > 0 && <RepoGrid repos={repos} />}
</div>
