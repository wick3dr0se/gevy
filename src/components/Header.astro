---
import { Image } from "astro:assets";
const { user } = Astro.props;
---

<header class="border-b border-gray-200 sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <div class="flex items-center gap-8">
        <a href="/dashboard" class="flex items-center gap-2">
          <Image
            src="/logo.svg"
            alt="Gevy logo"
            width="38"
            height="38"
            loading="eager"
          />
          <span class="text-xl font-bold">Gevy</span>
        </a>
        {
          user && (
            <nav class="hidden md:flex gap-6">
              <a
                href="/dashboard"
                class="text-[var(--subtext)] hover:text-[var(--text)]"
              >
                Dashboard
              </a>
              <a
                href="/feed"
                class="text-[var(--subtext)] hover:text-[var(--text)]"
              >
                Feed
              </a>
              <a
                href="/discover"
                class="text-[var(--subtext)] hover:text-[var(--text)]"
              >
                Discover
              </a>
            </nav>
          )
        }
      </div>

      {
        user && (
          <div class="flex items-center gap-4">
            <a
              href={`/profile/${user.github_username}`}
              class="flex items-center gap-2"
            >
              <Image
                src={user.avatar_url}
                alt={user.github_username}
                width="28"
                height="28"
                class="rounded-full"
                loading="eager"
              />
              <span class="text-[var(--subtext)] hover:text-[var(--text)] hidden sm:inline">
                {user.github_username}
              </span>
            </a>
            <form action="/api/auth/logout" method="POST">
              <button
                type="submit"
                class="text-sm text-[var(--subtext)] hover:text-[var(--text)]"
              >
                Logout
              </button>
            </form>
            <button type="button" class="p-2 rounded" aria-label="Toggle theme">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 4.5a1 1 0 0 1 1 1V7a1 1 0 1 1-2 0V5.5a1 1 0 0 1 1-1Zm0 12a1 1 0 0 1 1 1V19a1 1 0 1 1-2 0v-1.5a1 1 0 0 1 1-1Zm7.5-4.5a1 1 0 0 1 1 1H22a1 1 0 1 1 0 2h-1.5a1 1 0 1 1 0-2ZM3.5 12a1 1 0 0 1 1-1H6a1 1 0 1 1 0 2H4.5a1 1 0 0 1-1-1ZM16.95 7.05a1 1 0 0 1 1.414 0L19.071 8.76a1 1 0 1 1-1.414 1.414L16.95 8.465a1 1 0 0 1 0-1.415ZM4.929 15.243a1 1 0 0 1 1.414 0l.707.707a1 1 0 0 1-1.414 1.414l-.707-.707a1 1 0 0 1 0-1.414ZM4.93 8.465a1 1 0 1 1 1.414-1.415l.707.707A1 1 0 0 1 5.637 9.17l-.707-.707Zm11.314 7.071a1 1 0 1 1 1.415 1.415l-.707.707a1 1 0 1 1-1.415-1.415l.707-.707ZM12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8Z" />
              </svg>
            </button>
          </div>
        )
      }
    </div>
  </div>
</header>

<script>
  window.addEventListener("DOMContentLoaded", () => {
    const html = document.documentElement;

    // Apply theme on page load
    const savedTheme = localStorage.getItem("theme");
    if (
      savedTheme === "dark" ||
      (!savedTheme && window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
      html.classList.add("dark");
    } else {
      html.classList.remove("dark");
    }

    const toggleButton = document.querySelector('[aria-label="Toggle theme"]');
    if (toggleButton) {
      toggleButton.addEventListener("click", () => {
        html.classList.toggle("dark");
        localStorage.setItem(
          "theme",
          html.classList.contains("dark") ? "dark" : "light",
        );
      });
    }
  });
</script>
